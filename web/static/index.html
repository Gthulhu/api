<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gthulhu ‚Ä¢ eBPF Scheduler Control</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Ambient Background Effects -->
    <div class="ambient-grid"></div>
    <div class="scan-line"></div>
    
    <!-- Header -->
    <header class="main-header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">
                    <img src="logo.png" alt="Gthulhu Logo" class="logo-image">
                </div>
                <div class="logo-text">
                    <h1>GTHULHU</h1>
                    <span class="tagline">eBPF Scheduler Control Interface</span>
                </div>
            </div>
            <div class="auth-section" id="authSection">
                <div class="connection-status" id="connectionStatus">
                    <span class="status-dot"></span>
                    <span class="status-text">Disconnected</span>
                </div>
                <button class="auth-btn" id="authBtn" onclick="showLoginModal()">
                    <span class="btn-icon">‚ö°</span>
                    <span>Connect</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Login Modal -->
    <div id="loginModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h2>
                    <span class="modal-icon">üîê</span>
                    System Authentication
                </h2>
                <button class="modal-close" onclick="hideLoginModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="input-group">
                        <label for="email">
                            <span class="label-icon">üìß</span>
                            Email Address
                        </label>
                        <input type="email" id="email" name="email" placeholder="admin@gthulhu.io" required autocomplete="email">
                        <div class="input-glow"></div>
                    </div>
                    <div class="input-group">
                        <label for="password">
                            <span class="label-icon">üîë</span>
                            Password
                        </label>
                        <input type="password" id="password" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required autocomplete="current-password">
                        <div class="input-glow"></div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="submit-btn" id="loginSubmitBtn">
                            <span class="btn-text">Authenticate</span>
                            <span class="btn-loader"></span>
                        </button>
                    </div>
                    <div id="loginError" class="error-message"></div>
                </form>
            </div>
            <div class="modal-footer">
                <span class="security-note">üõ°Ô∏è Secure connection via JWT</span>
            </div>
        </div>
    </div>

    <!-- API Configuration Modal -->
    <div id="configModal" class="modal-overlay">
        <div class="modal-container modal-sm">
            <div class="modal-header">
                <h2>
                    <span class="modal-icon">‚öôÔ∏è</span>
                    API Configuration
                </h2>
                <button class="modal-close" onclick="hideConfigModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="apiBaseUrl">
                        <span class="label-icon">üåê</span>
                        API Base URL
                    </label>
                    <input type="url" id="apiBaseUrl" placeholder="http://localhost:8080">
                    <div class="input-glow"></div>
                    <small class="input-hint">Leave empty for same-origin requests</small>
                </div>
                <div class="form-actions">
                    <button type="button" class="submit-btn" onclick="saveApiConfig()">
                        <span class="btn-text">Save Configuration</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="dashboard">
        <!-- Quick Actions Bar -->
        <div class="quick-actions">
            <button class="action-chip" onclick="showConfigModal()">
                <span>‚öôÔ∏è</span> API Config
            </button>
            <button class="action-chip" onclick="checkHealth()">
                <span>üíì</span> Health Check
            </button>
            <button class="action-chip" onclick="getVersion()">
                <span>üì¶</span> Version
            </button>
            <button class="action-chip auth-required" onclick="refreshAllData()" disabled>
                <span>üîÑ</span> Refresh All
            </button>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- System Health Card -->
            <section class="card health-card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-icon">üíì</span>
                        <h2>System Health</h2>
                    </div>
                    <div class="card-actions">
                        <div class="auto-refresh-toggle">
                            <input type="checkbox" id="healthAutoRefresh" onchange="toggleHealthAutoRefresh()">
                            <label for="healthAutoRefresh">Auto</label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="health-display">
                        <div class="health-indicator" id="healthIndicator">
                            <div class="health-ring">
                                <svg viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="45" class="ring-bg"/>
                                    <circle cx="50" cy="50" r="45" class="ring-progress" id="healthRing"/>
                                </svg>
                                <div class="health-status" id="healthStatus">--</div>
                            </div>
                        </div>
                        <div class="health-history">
                            <span class="history-label">History (Last 10)</span>
                            <div class="history-grid" id="healthGrid"></div>
                        </div>
                    </div>
                    <div class="health-details" id="healthDetails">
                        <pre class="code-block">Awaiting health check...</pre>
                    </div>
                </div>
            </section>

            <!-- User Profile Card -->
            <section class="card user-card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-icon">üë§</span>
                        <h2>User Profile</h2>
                    </div>
                    <div class="card-actions">
                        <button class="icon-btn auth-required" onclick="getUserProfile()" title="Refresh Profile" disabled>
                            üîÑ
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="user-profile-display" id="userProfileDisplay">
                        <div class="user-avatar">
                            <div class="avatar-circle" id="userAvatar">?</div>
                            <div class="user-status-indicator" id="userStatusIndicator"></div>
                        </div>
                        <div class="user-main-info">
                            <div class="user-name" id="userDisplayName">Not Connected</div>
                            <div class="user-email-display" id="userEmailDisplay">Authenticate to view profile</div>
                        </div>
                        <div class="user-meta-grid">
                            <div class="user-meta-item">
                                <span class="meta-icon">üõ°Ô∏è</span>
                                <div class="meta-content">
                                    <span class="meta-label">Role</span>
                                    <span class="meta-value" id="userRoleDisplay">--</span>
                                </div>
                            </div>
                            <div class="user-meta-item">
                                <span class="meta-icon">üìä</span>
                                <div class="meta-content">
                                    <span class="meta-label">Status</span>
                                    <span class="meta-value" id="userStatusDisplay">Offline</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <details class="user-raw-details">
                        <summary>Raw Profile Data</summary>
                        <pre class="code-block" id="userDetails">Authenticate to view profile...</pre>
                    </details>
                </div>
            </section>

            <!-- Schedule Intents Card -->
            <section class="card intents-card full-width">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-icon">üìã</span>
                        <h2>Schedule Intents</h2>
                    </div>
                    <div class="card-actions">
                        <button class="icon-btn auth-required" onclick="getIntents()" title="Load Intents" disabled>
                            üîÑ
                        </button>
                        <button class="danger-btn auth-required" onclick="showDeleteIntentsModal()" disabled>
                            üóëÔ∏è Delete Intents
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="intents-list" id="intentsList">
                        <!-- Intents will be displayed here -->
                    </div>
                    <div class="intents-result">
                        <pre class="code-block" id="intentsResult">Authenticate to view schedule intents...</pre>
                    </div>
                </div>
            </section>

            <!-- Scheduling Strategies Card -->
            <section class="card strategies-card full-width">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-icon">üéØ</span>
                        <h2>Scheduling Strategies</h2>
                    </div>
                    <div class="card-actions">
                        <button class="icon-btn auth-required" onclick="getStrategies()" title="Load Strategies" disabled>
                            üì•
                        </button>
                        <button class="danger-btn auth-required" onclick="showDeleteStrategyModal()" disabled>
                            üóëÔ∏è Delete Strategy
                        </button>
                        <button class="primary-btn auth-required" onclick="addStrategy()" disabled>
                            <span>+</span> New Strategy
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="strategies-container" id="strategiesContainer">
                        <!-- Strategies will be dynamically added here -->
                    </div>
                    <div class="strategies-actions" id="strategiesActions" style="display: none;">
                        <button class="danger-btn" onclick="clearAllStrategies()">
                            üóëÔ∏è Clear Form
                        </button>
                        <button class="success-btn auth-required" onclick="saveAllStrategies()" disabled>
                            üíæ Create Strategy
                        </button>
                    </div>
                    <div class="strategies-result">
                        <pre class="code-block" id="strategiesResult">Add strategies above to configure scheduling behavior...</pre>
                    </div>
                </div>
            </section>

            <!-- Users Management Card (Admin) -->
            <section class="card users-card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-icon">üë•</span>
                        <h2>Users</h2>
                    </div>
                    <div class="card-actions">
                        <button class="icon-btn auth-required" onclick="getUsers()" title="Load Users" disabled>
                            üîÑ
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="users-result">
                        <pre class="code-block" id="usersResult">Authenticate to manage users...</pre>
                    </div>
                </div>
            </section>

            <!-- Roles & Permissions Card -->
            <section class="card roles-card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-icon">üõ°Ô∏è</span>
                        <h2>Roles & Permissions</h2>
                    </div>
                    <div class="card-actions">
                        <button class="icon-btn auth-required" onclick="getRoles()" title="Load Roles" disabled>
                            üîÑ
                        </button>
                        <button class="icon-btn auth-required" onclick="getPermissions()" title="Load Permissions" disabled>
                            üìú
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="roles-result">
                        <pre class="code-block" id="rolesResult">Authenticate to view roles...</pre>
                    </div>
                </div>
            </section>

            <!-- Pod-PID Mapping Card -->
            <section class="card pods-card full-width">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-icon">üê≥</span>
                        <h2>Pod-PID Mapping</h2>
                    </div>
                    <div class="card-actions">
                        <button class="icon-btn auth-required" onclick="getPodPids()" title="Load Pod-PID Mappings" disabled>
                            üîÑ
                        </button>
                        <button class="icon-btn" onclick="toggleAllPods(true)" title="Expand All">
                            ‚äû
                        </button>
                        <button class="icon-btn" onclick="toggleAllPods(false)" title="Collapse All">
                            ‚äü
                        </button>
                        <div class="auto-refresh-toggle">
                            <input type="checkbox" id="podPidsAutoRefresh" onchange="togglePodPidsAutoRefresh()">
                            <label for="podPidsAutoRefresh">Auto</label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="pods-summary" id="podsSummary">
                        <div class="summary-item">
                            <span class="summary-value" id="nodeNameDisplay">--</span>
                            <span class="summary-label">Node</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-value" id="podsCount">--</span>
                            <span class="summary-label">Pods</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-value" id="processesCount">--</span>
                            <span class="summary-label">Processes</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-value" id="lastUpdated">--</span>
                            <span class="summary-label">Last Updated</span>
                        </div>
                    </div>
                    <div class="pods-accordion" id="podsAccordion">
                        <!-- Pods will be rendered as collapsible items -->
                        <div class="pods-empty-state">Authenticate to view pod-PID mappings...</div>
                    </div>
                    <div class="pods-result">
                        <details>
                            <summary>Raw JSON Response</summary>
                            <pre class="code-block" id="podsResult">Authenticate to view pod-PID mappings...</pre>
                        </details>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Delete Intents Modal -->
    <div id="deleteIntentsModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h2>
                    <span class="modal-icon">üóëÔ∏è</span>
                    Delete Schedule Intents
                </h2>
                <button class="modal-close" onclick="hideDeleteIntentsModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="intentIds">
                        <span class="label-icon">üìã</span>
                        Intent IDs (comma separated)
                    </label>
                    <textarea id="intentIds" rows="3" placeholder="intent-id-1, intent-id-2"></textarea>
                    <div class="input-glow"></div>
                </div>
                <div class="form-actions">
                    <button type="button" class="danger-btn" onclick="deleteIntents()">
                        <span class="btn-text">Delete Intents</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Strategy Modal -->
    <div id="deleteStrategyModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h2>
                    <span class="modal-icon">üóëÔ∏è</span>
                    Delete Schedule Strategy
                </h2>
                <button class="modal-close" onclick="hideDeleteStrategyModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="strategyId">
                        <span class="label-icon">üéØ</span>
                        Strategy ID
                    </label>
                    <input type="text" id="deleteStrategyId" placeholder="strategy-id">
                    <div class="input-glow"></div>
                </div>
                <div class="form-actions">
                    <button type="button" class="danger-btn" onclick="deleteStrategy()">
                        <span class="btn-text">Delete Strategy</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <span class="version">v1.0.0</span>
            <span class="separator">‚Ä¢</span>
            <span class="copyright">Gthulhu Scheduler ¬© 2026</span>
            <span class="separator">‚Ä¢</span>
            <a href="https://github.com/Gthulhu/Gthulhu" target="_blank" class="github-link">
                GitHub
            </a>
        </div>
    </footer>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="app.js"></script>
</body>
</html>
